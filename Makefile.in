##########################################################################
#                                                                        #
#                 ACG development toolkit                                #
#                                                                        #
#                  Copyright 2008 INRIA                                  #
#                                                                        #
#  More information on "http://acg.gforge.loria.fr/"                     #
#  License: CeCILL, see the LICENSE file or "http://www.cecill.info"     #
#  Authors: see the AUTHORS file                                         #
#                                                                        #
#                                                                        #
#                                                                        #
#                                                                        #
#  $Rev::                              $:  Revision of last commit       #
#  $Author::                           $:  Author of last commit         #
#  $Date::                             $:  Date of last commit           #
#                                                                        #
##########################################################################

PHONY: config byte opt clean superclean install tar version release

BINARIES=acgc acgc.opt acg acg.opt

VERSION = $(shell date "+%Y-%m-%d")
RELEASE = acg-$(VERSION)

AR_EXCLUDE = 


prefix = @prefix@
exec_prefix = @exec_prefix@

essai:
	echo $(DATE)

byte opt: 
	$(MAKE) -C src $@
	for file in $(BINARIES); do find . -name "$$file" -exec cp {} . \; ; done

all: byte opt

clean:
	if test "$@" = clean ; then $(MAKE) -C config $@ ; fi
	$(MAKE) -C src $@
	rm -rf *.log  *~ autom4te.cache
	find . -name "*~" -exec rm -f {} \;
	-for file in $(BINARIES); do rm $$file ; done

superclean: clean
	-find . -name "*.in" -print | sed -e 's/\(.*\)\.in/\1/' | xargs -n 1 rm

install:
	for file in $(BINARIES); do if test -x $$file ; then cp $$file @bindir@/. ; fi ; done

uninstall:
	for file in $(BINARIES); do if test -x @bindir@/$$file ; then rm @bindir@/$$file ; fi ; done


# Part for the auto configuration

config: configure

configure: config/configure.ac
	cd $(<D) && autoconf && mv configure .. & cd ..

tar: version superclean
	if test -a ../$(RELEASE) ; then rm ../$(RELEASE) ; fi
	cd .. && ln -s trunk $(RELEASE) && cd trunk
	tar cvfz $(RELEASE).tar.gz -C .. -h $(RELEASE) --exclude="*\.svn*" --exclude "$(RELEASE)/data" --exclude "$(RELEASE)/src/data" --exclude "$(RELEASE)/src/*.old" --exclude "$(RELEASE)/*.tar*"
	if test -a ../$(RELEASE) ; then rm ../$(RELEASE) ; fi
	./configure

version :
	sed -i 's/@VERSION@/$(VERSION)/' src/utils/version.ml

release :